<html>
    <head>
        <script src="./dist/bundle.js"></script>
        <style>
            #graph > table td {
                width: 20px;
                height: 20px;
                border: solid 1px black;
                margin: 5px;
            }
        </style>
    </head>
    <body>
        <h1>Choose a zoia patch file, see the contents</h1>
        <form>
            <input type="file" name="patchFile" id="patchFile" />
        </form>
        <div id="graph">
            <table>
                <tr><td id="b0"></td><td id="b1"></td><td id="b2"></td><td id="b3"></td><td id="b4"></td><td id="b5"></td><td id="b6"></td><td id="b7"></td></tr>
                <tr><td id="b8"></td><td id="b9"></td><td id="b10"></td><td id="b11"></td><td id="b12"></td><td id="b13"></td><td id="b14"></td><td id="b15"></td></tr>
                <tr><td id="b16"></td><td id="b17"></td><td id="b18"></td><td id="b19"></td><td id="b20"></td><td id="b21"></td><td id="b22"></td><td id="b23"></td></tr>
                <tr><td id="b24"></td><td id="b25"></td><td id="b26"></td><td id="b27"></td><td id="b28"></td><td id="b29"></td><td id="b30"></td><td id="b31"></td></tr>
                <tr><td id="b32"></td><td id="b33"></td><td id="b34"></td><td id="b35"></td><td id="b36"></td><td id="b37"></td><td id="b38"></td><td id="b39"></td></tr>
            </table>
        </div>
        <pre id="container"></pre>
        <script>
            document.querySelector('#patchFile').addEventListener('change', () => {
                const fileInput = document.forms[0].patchFile;
                const fileName = fileInput.value;
                if (fileInput.files) {
                    const reader = new FileReader();
                    reader.readAsArrayBuffer(fileInput.files[0]);
                    reader.onload = function (evt) {
                        const patch = new ZoiaPatch(Buffer.Buffer.from(evt.target.result));
                        document.querySelector('#container').innerHTML = JSON.stringify(patch.schema, null, 2);
                        plotSchema(patch.schema);
                    };
                    reader.onerror = function () {
                        document.querySelector('#container').innerHTML = reader.error;
                    }
                }
            });
            function plotSchema(schema) {
                document.querySelectorAll('td').forEach(el => el.style.backgroundColor = '');
                schema.modules.data.filter(mod => mod.pageNumber === 0).forEach(
                    mod => {
                        let size = [1, 2].includes(mod.type) ? 1 : 2;
                        size += mod.params.length;
                        const pos = mod.gridPosition;
                        for (let i = pos; i < Math.min(pos+size, 39); i++) {
                            document.querySelector(`#b${i}`).style.backgroundColor = mod.colourName.toLowerCase();
                        }
                    }
                );
            }
        </script>
    </body>
</html>

